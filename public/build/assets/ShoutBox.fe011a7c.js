import{I as T}from"./AppLayout.80ad2bf1.js";import{_ as D,Z as v,p as x,v as b,o as t,d as r,a as o,t as a,e as n,F as k,h as I,x as g,y as N,X as B,b as c,w as h,f as i,J as w,c as S,m as V}from"./app.a3e7b7f5.js";const C={components:{Icon:T},data(){return{shouts:[],message:"",error:null,loading:!0,sending:!1,shoutQueryInterval:null}},created(){axios.get(route("shout.index")).then(e=>{this.shouts=e.data}).finally(()=>{this.loading=!1}),v?Echo.channel("shouts").listen("ShoutCreated",e=>{this.shouts.unshift(e.data)}):this.shoutQueryInterval=setInterval(()=>this.pollServerForNewShouts(),5e3)},unmounted(){this.shoutQueryInterval&&clearInterval(this.shoutQueryInterval)},methods:{sendShout(){this.sending=!0,this.error=null,axios.post(route("shout.store"),{message:this.message}).then(e=>{e.status===200&&this.shouts.unshift(e.data)}).catch(e=>{e.response.status===422?this.error=e.response.data.errors.message[0]:e.response.status===403?this.error=e.response.data.message:this.error=this.__("Something went wrong. Try again.")}).finally(()=>{this.message="",this.sending=!1,this.$nextTick(()=>{this.$refs.inputbox.focus()})})},pollServerForNewShouts(){if(v)return;const e=this.shouts.length>0?this.shouts[0].id:0;axios.get(route("shout.index",{after:e})).then(d=>{const p=d.data;p.length>0&&(this.shouts=[...p,...this.shouts])})}}},E={key:0},F={class:"p-3 space-y-4 bg-white rounded shadow dark:bg-cool-gray-800"},Q={class:"font-extrabold text-gray-800 dark:text-gray-200"},j={class:"flex-col space-y-4 overflow-auto max-h-96 hide-scrollbar"},K={key:0,class:"space-y-4"},M=V('<div class="w-full max-w-sm mx-auto"><div class="flex space-x-4 animate-pulse"><div class="w-8 h-8 bg-gray-300 rounded-full dark:bg-cool-gray-700"></div><div class="flex-1 py-1 space-y-1"><div class="w-3/4 h-4 bg-gray-300 rounded dark:bg-cool-gray-700"></div><div class="w-5/6 h-4 bg-gray-300 rounded dark:bg-cool-gray-700"></div></div></div></div><div class="w-full max-w-sm mx-auto"><div class="flex space-x-4 animate-pulse"><div class="w-8 h-8 bg-gray-300 rounded-full dark:bg-cool-gray-700"></div><div class="flex-1 py-1 space-y-1"><div class="w-3/4 h-4 bg-gray-300 rounded dark:bg-cool-gray-700"></div><div class="w-5/6 h-4 bg-gray-300 rounded dark:bg-cool-gray-700"></div></div></div></div>',2),$=[M],A={key:0,class:"flex"},L={class:"items-start order-2 max-w-xs mx-2 space-y-2 text-sm"},R={class:"flex flex-col inline-block px-4 py-2 text-gray-700 bg-gray-100 rounded-tl-lg rounded-2xl dark:bg-cool-gray-600 dark:bg-opacity-25 dark:text-gray-200"},U=["title"],z={class:"text-justify"},J=["src"],O={key:1,class:"flex justify-end"},W={class:"items-start order-1 max-w-xs mx-2 space-y-2 text-sm"},X={class:"flex flex-col inline-block px-4 py-2 text-gray-700 rounded-tr-lg rounded-2xl bg-light-blue-100 dark:bg-cool-gray-900 dark:bg-opacity-40 dark:text-gray-200"},Z={class:"text-right"},q=["title"],G={class:"text-justify"},H=["src"],P={key:0},Y=["disabled","placeholder"],ee={key:1,class:"text-xs text-red-400"},se={key:1,class:"text-sm text-center text-gray-600 dark:text-gray-400"};function te(e,d,p,re,l,f){const u=x("inertia-link"),y=x("icon"),m=b("tippy"),_=b("confirm");return e.$page.props.generalSettings.enable_shoutbox?(t(),r("div",E,[o("div",F,[o("h3",Q,a(e.__("Shout Box")),1),o("div",j,[l.loading?(t(),r("div",K,$)):n("",!0),(t(!0),r(k,null,I(l.shouts,s=>(t(),r("div",{key:s.id,class:"chat-message"},[!e.$page.props.user||s.user_id!==e.$page.props.user.id?(t(),r("div",A,[o("div",L,[o("div",R,[o("div",null,[c(u,{as:"span",href:e.route("user.public.get",s.user.username),class:"font-semibold cursor-pointer hover:underline",style:w([s.user.roles[0].color?{color:s.user.roles[0].color}:null])},{default:h(()=>[i(a(s.user.username),1)]),_:2},1032,["href","style"]),g((t(),r("span",{class:"ml-1 text-xs text-gray-500 dark:text-gray-400 focus:outline-none",title:e.formatToDayDateString(s.created_at)},[i(a(e.formatTimeAgoToNow(s.created_at,!1)),1)],8,U)),[[m]])]),o("span",z,a(s.message),1)])]),o("img",{src:s.user.profile_photo_url,alt:"My profile",class:"order-1 w-8 h-8 mt-2 rounded-full"},null,8,J),e.$page.props.user&&s.permissions.delete?g((t(),S(u,{key:0,class:"order-3 focus:outline-none","preserve-state":!1,as:"button",method:"delete",href:e.route("shout.delete",s.id)},{default:h(()=>[c(y,{class:"w-4 h-4 text-gray-200 dark:text-gray-500 hover:text-red-400 dark:hover:text-red-500",name:"trash"})]),_:2},1032,["href"])),[[_,{message:e.__("Delete this shout permanently?")}]]):n("",!0)])):(t(),r("div",O,[e.$page.props.user&&s.permissions.delete?g((t(),S(u,{key:0,class:"focus:outline-none","preserve-state":!1,as:"button",method:"delete",href:e.route("shout.delete",s.id)},{default:h(()=>[c(y,{class:"w-4 h-4 text-gray-200 dark:text-gray-500 hover:text-red-400 dark:hover:text-red-500",name:"trash"})]),_:2},1032,["href"])),[[_,{message:e.__("Delete this shout permanently?")}]]):n("",!0),o("div",W,[o("div",X,[o("div",Z,[g((t(),r("span",{class:"mr-1 text-xs text-gray-500 dark:text-gray-400 focus:outline-none",title:e.formatToDayDateString(s.created_at)},[i(a(e.formatTimeAgoToNow(s.created_at,!1)),1)],8,q)),[[m]]),c(u,{as:"span",href:e.route("user.public.get",s.user.username),class:"font-semibold cursor-pointer hover:underline",style:w([s.user.roles[0].color?{color:s.user.roles[0].color}:null])},{default:h(()=>[i(a(s.user.username),1)]),_:2},1032,["href","style"])]),o("span",G,a(s.message),1)])]),o("img",{src:s.user.profile_photo_url,alt:"My profile",class:"order-2 w-8 h-8 mt-2 rounded-full"},null,8,H)]))]))),128))]),e.$page.props.user?(t(),r("div",P,[l.loading?n("",!0):g((t(),r("input",{key:0,ref:"inputbox","onUpdate:modelValue":d[0]||(d[0]=s=>l.message=s),disabled:l.sending,"aria-label":"Shout",class:"block w-full mt-1 bg-gray-100 border-none rounded-md focus:ring-gray-300 sm:text-sm disabled:opacity-50 focus:bg-white dark:bg-cool-gray-900 dark:text-gray-200 dark:focus:ring-gray-700",type:"text",placeholder:e.__("Say something.."),onKeypress:d[1]||(d[1]=B((...s)=>f.sendShout&&f.sendShout(...s),["enter"]))},null,40,Y)),[[N,l.message]]),l.error?(t(),r("span",ee,a(l.error),1)):n("",!0)])):(t(),r("div",se,[c(u,{class:"font-semibold text-light-blue-500",href:e.route("login")},{default:h(()=>[i(a(e.__("Login")),1)]),_:1},8,["href"]),e.$page.props.hasRegistrationFeature?(t(),r(k,{key:0},[i(a(" "+e.__("or"))+" ",1),c(u,{class:"font-semibold text-light-blue-500",href:e.route("register")},{default:h(()=>[i(a(e.__("Register")),1)]),_:1},8,["href"])],64)):n("",!0),i(" "+a(e.__("to Shout")),1)]))])])):n("",!0)}const le=D(C,[["render",te]]);export{le as S};
